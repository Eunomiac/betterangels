import{C as t,gsap as e,Dragger as a,MotionPathPlugin as o,U as s,MIX as i,UpdateQueue as n}from"../helpers/bundler.mjs";export default class extends(i(ActorSheet).t(n)){static get o(){return mergeObject(super.o,{i:["betterangels","sheet","actor"],l:"systems/betterangels/templates/actor/actor-sheet.html",width:476,height:786,p:[{h:".sheet-tabs",u:".sheet-body",m:"front"}]})}get l(){return`systems/betterangels/templates/actor/actor-${this.$.data.type}-sheet.html`}getData(){const t=super.getData(),e=s.g(t.$.data);return t.data=e.data,t.flags=e.flags,["hellbound","minornpc","mobnpc"].includes(e.type)&&(this.v(t),this.F(t)),t.k=t.$.C(),t}_(t){t.preventDefault(),console.log("Open Menu",t);const[a]=$(t.currentTarget).find(".menu-positioner");$(a).find(".radial-menu").hasClass("active")||(e.set(a,{D:-50,O:-50,x:t.offsetX,y:t.offsetY}),$(a).find("video").each((function(){this.play()})),$(a).find(".radial-menu").addClass("active"))}M(t){t.preventDefault();const[e]=$(t.currentTarget).find(".menu-positioner");$(e).find("video").each((function(){this.pause()})),$(e).find(".radial-menu").removeClass("active"),setTimeout((()=>this.T()),500)}A(t){t.preventDefault();const[a]=$(t.currentTarget).find("video");a.status="fade-in",e.R(a,{opacity:.1},{opacity:1,duration:.5,j:"sine"}),a.play()}S(t){t.preventDefault();const[a]=$(t.currentTarget).find("video");a.status="fade-out",e.to(a,{opacity:0,duration:.5,j:"sine"})}I(a,o){const{target:i,value:n}=a.dataset,[{dataset:{target:r,value:l}}]=$(o)?.find(".draggable")??[{dataset:{}}],[c]=$(o).find(".display");$(c).addClass("big-gold click-through"),e.to(a,{scale:5,y:"-=75px",opacity:0,duration:1,j:"power.out",L:function(){$(this).removeClass("click-through"),e.set(this,{opacity:0,x:0,y:0,scale:1})}.bind(a)}),e.to(c,{scale:5,y:"+=75px",opacity:0,duration:1,j:"power.out",L(){$(c).removeClass("big-gold"),e.set(c,{scale:1,y:"-=75px"}),e.R(c,{opacity:0},{opacity:1,duration:.25,j:"sine",L(){$(c).removeClass("click-through"),e.set(c,{y:0}),e.set(a,{opacity:0})}})}});const p=[];t.B.includes(i)?(p.push(`<h1><span style="color: darkgreen !important; font-weight: bold !important; font-style: normal !important;">${s.H(i)}</span> ${n} + `),p.push(`<span style="color: purple !important; font-weight: normal !important; font-style: italic !important;">${s.H(r)}</span> ${l}</h1>`)):(p.push(`<h1><span style="color: darkgreen !important; font-weight: bold !important; font-style: normal !important;">${s.H(r)}</span> ${l} + `),p.push(`<span style="color: purple !important; font-weight: normal !important; font-style: italic !important;">${s.H(i)}</span> ${n}</h1>`)),p.push(`<h3>(${s.P(n)+s.P(l)} Dice Total)`),$("#sheet-message").html(p.join(""));const[h]=$("#sheet-message").find("h1"),[d]=$("#sheet-message").find("h3");e.R(h,{scale:10,opacity:0},{scale:1,opacity:1,duration:.5,j:"power4.out"}),e.R(d,{scale:1,y:"+=300px",opacity:0},{y:0,opacity:1,duration:1,j:"power4.in",L(){e.to("#sheet-message *",{opacity:0,scale:5,duration:.5,delay:1,V:.2,j:"power4.out"})}})}G(t,a){const[o]=$(`.app.betterangels #${t}-${a} > .dot-animation`);e.timeline({L(){$(o).removeClass("empty")}}).R(o,{scale:7,backgroundColor:"#FFFFFF",opacity:0},{scale:1,opacity:1,backgroundColor:"#FFFFFF",j:"sine",duration:.5})}N(t,a){const[o]=$(`#${t}-${a} > .dot-animation`);e.timeline({L(){$(o).addClass("empty")}}).R(o,{scale:1,backgroundColor:"#FFFFFF",opacity:1},{scale:10,opacity:0,backgroundColor:"#FFFFFF",j:"sine",duration:.75})}q(t,a,o,i){console.log({J:t,K:a,U:o,W:i});const[n]=$(`.app.betterangels #${o}-${i} > .dot-animation`),[r]=$(`.app.betterangels #${t}-${a} > .dot-animation`),l=s.X({x:0,y:0},$(r).parent()[0],$(n).parent()[0]);console.log(n,r,l),e.to(n,{...l,duration:1,j:"elastic.inOut",L(){$(r).removeClass("empty"),$(n).addClass("empty"),e.set(n,{x:0,y:0})}}),e.to(n,{scale:3,duration:.5,repeat:1,Y:!0,j:"elastic.inOut"})}F(e){Object.entries(t.Z).forEach((([t,a])=>{const[o,s]=this.tt(t);Object.assign(e.data[t],{name:o.name,et:o.max-o.value,ot:o.st,it:o.add,nt:o.rt}),Object.assign(e.data[a],{name:s.name,et:s.max-s.value,ot:s.st,it:s.add,nt:s.rt})}))}v(t){Object.assign(t.data,{lt:t.items.filter((t=>"power"===t.type)),ct:t.items.filter((t=>"aspect"===t.type)),ht:t.items.filter((t=>"device"===t.type))})}dt(t){if(super.dt(t),t.find(".feature").click((t=>{this.$.items.get(t.currentTarget.dataset.itemId).sheet.ut(!0)})),!this.$t)return;const o=this;t.find(".radial-hover").contextmenu(this._.bind(this)),t.find(".radial-hover").yt(this.M.bind(this)),t.find(".trait-pair > label").gt(this.A.bind(this),this.S.bind(this)),t.find(".trait-button").click(this.bt.bind(this)),t.find(".trait-button").contextmenu(this.bt.bind(this)),Hooks.on("preCreateItem",((t,e)=>{const{type:a}=e;switch(e.type){case"power":{const t=Array.from(this.$.items.values()).filter((t=>"power"===t.data.type));3===t.length&&t[0].delete();break}case"aspect":{const t=Array.from(this.$.items.values()).filter((t=>"aspect"===t.data.type));2===t.length&&t[0].delete();break}}})),a.create(".draggable.trait",{ft(){this.vt=Array.from($(".droppable")).filter((t=>!new RegExp(`${this.target.dataset.target}$`).test(t.id))),[this.Ft]=$(this.target).parent(),s.wt(this.target,$("#x-container")[0]),this.update(!1,!0),e.to(this.target,{scale:2,opacity:1,duration:2,j:"elastic.out"})},kt(){this.vt.forEach((t=>{if(this.xt(t,"50%"))e.to($(t).find(".display").addClass("highlight"),{y:-10,scale:3,j:"power4.out",duration:.5}),this.Ct=t;else if(this.Ct?.id!==t.id){const[a]=$(t).find(".display");$(a).removeClass("highlight"),e.to(a,{y:0,scale:1,j:"power4.out",duration:.5})}}))},_t(){const t=this;$(".droppable .display.highlight").each(((a,i)=>{$(i).removeClass("highlight"),s.wt(this.target,this.Ft),e.to(i,{y:0,scale:1,j:"power4.out",duration:.5,L(){o.I(t.target,t.Ct)}})})),$(this.target).addClass("click-through")}})}tt(e){const[a,o]=[e,t.Dt[e]],{min:s,max:i,value:n}=this.Ot.data[a],{min:r,max:l,value:c}=this.Ot.data[o];return[{name:a,min:s,max:i,value:n,add:n<i&&n+c<7,rt:n>s,st:n<i&&c>r},{name:o,min:r,max:l,value:c,add:c<l&&n+c<7,rt:c>r,st:c<l&&n>s}]}Mt(t,e){return this.tt(t)[0][e]}Tt(e){e=t.At[e]??e;const[a,o]=this.tt(e);Object.entries({[`#menu-add-${a.name}`]:a.add,[`#menu-add-${o.name}`]:o.add,[`#menu-drop-${a.name}`]:a.rt,[`#menu-drop-${o.name}`]:o.rt,[`#menu-slide-${a.name}`]:a.st,[`#menu-slide-${o.name}`]:o.st,[`#menu-add-drop-${a.name}`]:a.add||a.rt,[`#menu-add-drop-${o.name}`]:o.add||o.rt,[`#menu-slash-${a.name}`]:a.add&&a.rt,[`#menu-slash-${o.name}`]:o.add&&o.rt}).forEach((([t,e])=>{e?$(t).removeClass("off"):$(t).addClass("off")}))}async bt(e){e.preventDefault(),console.log({Rt:e});const{jt:a,St:o,target:s}=e.target.dataset,{data:i}=this.Ot,n={click:a,contextmenu:o}[e.type];if(this.Mt(s,n)){switch(n){case"add":{const t=Math.min(i[s].max,i[s].value+1);this.It({[`data.${s}.value`]:t}),this.G(s,t);break}case"drop":this.N(s,i[s].value),this.It({[`data.${s}.value`]:Math.max(i[s].min,i[s].value-1)});break;case"slide":{const e=t.Dt[s],a=Math.min(i[s].max,i[s].value+1);this.q(s,a,e,i[e].value),this.It({[`data.${s}.value`]:a,[`data.${e}.value`]:Math.max(i[e].min,i[e].value-1)});break}default:return!1}return this.Tt(s),!0}return!1}async Et(t){console.log("On Item Create Called")}Lt(t){t.preventDefault();const e=t.currentTarget,{dataset:a}=e;if(a.Bt&&"item"===a.Bt){const{itemId:t}=e.closest(".item").dataset,a=this.$.items.get(t);if(a)return a.Ht()}if(a.Ht){const t=a.label?`[roll] ${a.label}`:"",e=new Roll(a.Ht,this.$.C()).Ht();return e.Pt({Vt:ChatMessage.getSpeaker({$:this.$}),Gt:t,Nt:game.settings.get("core","rollMode")}),e}return!1}}