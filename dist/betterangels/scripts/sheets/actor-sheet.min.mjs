import{gsap as t,Dragger as e,InertiaPlugin as a,MotionPathPlugin as o,GSDevTools as s,RoughEase as r,U as i,MIX as n,UpdateQueue as l}from"../helpers/bundler.mjs";export default class extends(n(ActorSheet).t(l)){static get o(){return mergeObject(super.o,{i:["betterangels","sheet","actor"],l:"systems/betterangels/templates/actor/actor-sheet.html",width:700,height:700,h:[{u:".sheet-tabs",m:".sheet-body",p:"stats"}]})}get l(){return`systems/betterangels/templates/actor/actor-${this.$.data.type}-sheet.html`}getData(){const t=super.getData(),e=i.g(t.$.data);return t.data=e.data,t.flags=e.flags,["hellbound","minornpc","mobnpc"].includes(e.type)&&(this.v(t),this.C(t)),t.D=t.$.k(),t}C(t){Object.entries(CONFIG.BETTERANGELS.sinisterTraitPairs).forEach((([e,a])=>{const{min:o,max:s,value:r}=t.data[e],{min:i,max:n,value:l}=t.data[a];Object.assign(t.data[e],{name:e,O:s-r,I:r<s&&l>i&&r+l<7,M:r<s&&r+l<7,S:r>o}),Object.assign(t.data[a],{name:a,O:n-l,I:l<n&&r>o&&r+l<7,M:l<n&&r+l<7,S:l>i})}))}T(t){console.log(t),$(t.currentTarget).find(".radial-menu")?.addClass("active")}_(t){$(".radial-menu.active").removeClass("active"),setTimeout((()=>this.A()),500)}N(e,a){const[o]=$(`#${e}-${a} > .dot-animation`),[s]=$(o).closest(".radial-hover").find(".radial-menu"),[r]=$(s).find("video");t.j(r,"scale");t.timeline({F(){$(o).removeClass("empty")}}).R(o,{scale:7,backgroundColor:"rgb(0, 0, 0)",opacity:0},{scale:1,opacity:1,backgroundColor:"rgb(0, 0, 0)",G:"power4.in",duration:.5},.25)}H(e,a){const[o]=$(`#${e}-${a} > .dot-animation`),[s]=$(o).closest(".radial-hover").find(".radial-menu"),[r]=$(s).find("video"),i=t.j(r,"scale");console.log(`Scale: ${i}`);t.timeline({F(){$(o).addClass("empty")}}).R(o,{scale:1,backgroundColor:"rgb(0, 0, 0)",opacity:1},{scale:10,opacity:0,backgroundColor:"rgb(0, 0, 0)",G:"power4.out",duration:.75},.25)}L(t,e,a,o){this.N(t,e),this.H(a,o)}v(t){const e=[],a=[];for(const o of t.items)o.B=o.B||DEFAULT_TOKEN,"item"===o.type?e.push(o):"feature"===o.type&&a.push(o);t.K=e,t.features=a}U(a){if(super.U(a),Hooks.once("renderActorSheet",(()=>a.find(".radial-menu video").q((function(){this.play()})))),!this.J)return;const o=this;a.find(".radial-hover").contextmenu(this.T.bind(this)),a.find(".radial-hover").P(this._.bind(this)),a.find(".trait-button").click(this.V.bind(this)),e.create(".trait-pair > label > span",{W(){t.to(this.target,{scale:2,opacity:1,duration:2,G:"elastic"})},X(){$(this.target).addClass("click-through"),t.to(this.target,{scale:5,opacity:0,duration:1,G:"power.out",F(){$(this.target).removeClass("click-through"),o.Y(!0)}})}})}Z(t){t=CONFIG.BETTERANGELS.virtuousTraitPairs[t]??t;const[e,a]=[t,CONFIG.BETTERANGELS.traitPairs[t]],{min:o,max:s,value:r}=this.tt.data[e],{min:i,max:n,value:l}=this.tt.data[a];Object.entries({[`#menu-add-${e}`]:r<s&&r+l<7,[`#menu-add-${a}`]:l<n&&r+l<7,[`#menu-drop-${e}`]:r>o,[`#menu-drop-${a}`]:l>i,[`#menu-slide-${e}`]:r<s&&l>i&&r+l<7,[`#menu-slide-${a}`]:l<n&&r>o&&r+l<7}).forEach((([t,e])=>{e?$(t).removeClass("empty"):$(t).addClass("empty")}))}async V(t){console.log({et:t});const{action:e,target:a}=t.target.dataset,{data:o}=this.tt;switch(e){case"add":{const t=Math.min(o[a].max,o[a].value+1);this.ot({[`data.${a}.value`]:t}),this.N(a,t);break}case"drop":this.H(a,o[a].value),this.ot({[`data.${a}.value`]:Math.max(o[a].min,o[a].value-1)});break;case"slide":{const t=CONFIG.BETTERANGELS.traitPairs[a],e=Math.min(o[a].max,o[a].value+1);this.L(a,e,t,o[t].value),this.ot({[`data.${a}.value`]:e,[`data.${t}.value`]:Math.max(o[t].min,o[t].value-1)});break}default:return!1}return this.Z(a),!0}async st(t){t.preventDefault();const e=t.currentTarget,{type:a}=e.dataset,o=duplicate(e.dataset),s={name:`New ${a.rt()}`,type:a,data:o};return delete s.data.type,await Item.create(s,{parent:this.$})}it(t){t.preventDefault();const e=t.currentTarget,{dataset:a}=e;if(a.nt&&"item"===a.nt){const{itemId:t}=e.closest(".item").dataset,a=this.$.items.get(t);if(a)return a.lt()}if(a.lt){const t=a.label?`[roll] ${a.label}`:"",e=new Roll(a.lt,this.$.k()).lt();return e.ct({dt:ChatMessage.getSpeaker({$:this.$}),ht:t,ut:game.settings.get("core","rollMode")}),e}return!1}}