export default class extends ActorSheet{static get t(){return mergeObject(super.t,{i:["betterangels","sheet","actor"],o:"systems/betterangels/templates/actor/actor-sheet.html",width:700,height:700,l:[{h:".sheet-tabs",m:".sheet-body",p:"human"}]})}get o(){return`systems/betterangels/templates/actor/actor-${this.u.data.type}-sheet.html`}getData(){const t=super.getData(),e=t.u.data;return t.data=e.data,t.flags=e.flags,"character"===e.type&&(this.g(t),this.I(t)),t.$=t.u._(),t}I(t){}g(t){const e=[],s=[];for(const a of t.items)a.v=a.v||DEFAULT_TOKEN,"item"===a.type?e.push(a):"feature"===a.type&&s.push(a);t.C=e,t.features=s}D(t){if(super.D(t),t.find(".item-edit").click((t=>{const e=$(t.currentTarget).parents(".item");this.u.items.get(e.data("itemId")).sheet.M(!0)})),this.O&&(t.find(".item-create").click(this.S.bind(this)),t.find(".item-delete").click((t=>{const e=$(t.currentTarget).parents(".item");this.u.items.get(e.data("itemId")).delete(),e.A(200,(()=>this.M(!1)))})),t.find(".rollable").click(this.L.bind(this)),this.u.N)){const e=t=>this.R(t);t.find("li.item").T(((t,s)=>{s.classList.contains("inventory-header")||(s.setAttribute("draggable",!0),s.addEventListener("dragstart",e,!1))}))}}async S(t){t.preventDefault();const e=t.currentTarget,{type:s}=e.dataset,a=duplicate(e.dataset),r={name:`New ${s.j()}`,type:s,data:a};return delete r.data.type,await Item.create(r,{parent:this.u})}L(t){t.preventDefault();const e=t.currentTarget,{dataset:s}=e;if(s.k&&"item"===s.k){const{itemId:t}=e.closest(".item").dataset,s=this.u.items.get(t);if(s)return s.F()}if(s.F){const t=s.label?`[roll] ${s.label}`:"",e=new Roll(s.F,this.u._()).F();return e.K({U:ChatMessage.getSpeaker({u:this.u}),q:t,B:game.settings.get("core","rollMode")}),e}return!1}}