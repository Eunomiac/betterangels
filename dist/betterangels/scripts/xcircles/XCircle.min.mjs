import{gsap as t,Dragger as s,InertiaPlugin as e,MotionPathPlugin as i,RoughEase as r,U as n,XElem as h,XItem as o,XDie as a,XSnap as l,MIX as p,HasSnapPath as c}from"../helpers/bundler.mjs";export default class u extends(p(h).t(c)){static get i(){return{...super.i,h:"pink",o:"yellow",l:"cyan",p:"purple",u:"sparkle",g:"nova",m:"flare"}}static get S(){return{...super.S,$:[...super.S.$,"x-circle"],v:"xCircle"}}static P({x:s,y:e},i){const r=Array.from(this.k.entries()).filter((([t,s])=>i?.name!==s.name)).map((([t])=>t)),n=t.A.I({values:r},{x:s,y:e}),h=this.k.get(n);return{...n,T:h}}static O(t){return this.P(t).T}constructor(t,s,e,i={}){super($(`\n    <div style="height: ${2*e}px; width: ${2*e}px;">\n\t\t\t<video width="200%" height="200%" autoplay muted loop style="left: -50%; top: -47%;">\n\t\t\t\t<source src="/systems/betterangels/assets/animations/xcircle-bg-${i.type??u.S.C}.webm" type="video/webm">\n\t\t\t</video>\n      <svg height="100%" width="100%">\n        <path class="circle-path" stroke="none" d="${n.D(e,{x:e,y:e})}"></path>\n        <path class="motion-path" fill="none" stroke="none" d="${n.D(.8*e,{x:e,y:e})}"></path>\n      </svg>\n    </div>`),{properties:{x:t,y:s},M:{x:.8*e,y:.8*e},U:[`x-circle-${i.type??u.S.C}`],...i}),this.B(!0)}get rotation(){return super.rotation}set rotation(t){super.rotation=t,this.F.forEach((t=>t.L?.()))}get F(){return this.N=this.N??[]}get R(){return this._=this._??{}}B(s){Boolean(s)!==Boolean(this.j)&&(s?this.j=t.to(this.G,{rotation:"+=360",duration:100,repeat:-1,X:"rough",Y:this,q(){this.F.forEach((t=>t.L?.()))}}):(this.j.H(),delete this.j))}get J(){this.K=new Map;let s=0;this.F.forEach((t=>{s+=t.V,this.K.set(t,s-.5*t.V)}));for(const[e,i]of this.K.entries())this.K.set(e,t.A.normalize(0,s,i));return this.K}get W(){return Array.from(this.J.values())}Z(t){return{...this.tt(this.J.get(t)),slot:this.F.findIndex((s=>s===t))}}st(t){return this.F.find((s=>s instanceof l&&s.et===t))}it(t){return(t??this.F).map((t=>this.Z(t)))}rt(t){return this.it(t).map((t=>t.nt))}ht(t,s){s=s??{x:t.x,y:t.y};const{nt:e}=this.ot(t,s),i=Array.from(this.J.values()),r=Math.max(0,i.findIndex((t=>t>=e))),n=0===r?this.J.size-1:r-1;let h=this.W[r],o=this.W[n];for(;h<e;)h++;for(;o>e;)o--;return h-e>e-o?n:r}lt(t,s){return n.ct(s)?this.N=[...this.N.slice(0,s),t,...this.N.slice(s)]:this.F.push(t),t}ut(t,s){s=s??this.F.find((s=>s.et===t));const e=this.F.findIndex((t=>t===s));if(n.ct(e))return this.F[e]=t,this.dt===s&&delete this.dt,s;throw new Error(`${s.name} not found in ${this.name}: ${t.name} NOT swapped in.`)}removeItem(t){if(this.F.includes(t))return this.N=this.F.filter((s=>s!==t)),this.dt===t&&delete this.dt,t;throw new Error(`${t.name} not found in ${this.name}`)}yt(t){this.removeItem(t).H()}async gt(t=.5,s){const e=this.rt();return Promise.allSettled(this.F.map(((i,r)=>i.wt(e[r],t,s))))}async ft(t=1,s){return[...Array(t)].forEach((()=>this.lt(new a({parent:this,type:s})))),this.gt(5)}async xt(t,s=1){return this.removeItem(t),this.gt(s)}St(t,s){const{x:e,y:i}=this.ot(t,s),r=new l(t,{parent:this,properties:s});return this.dt=r,this.lt(r,this.ht(t,s))}async $t(s){this.B(!1);const e=this.St(s);await this.gt(.1);const i=n.vt(this.Pt,e.Pt,this.Pt),r=n.vt(this.Pt,s.kt,this.Pt),h=n.bt(i,r),o=n.It(this.rotation+h),a=s.Tt.At.duration(),l=this.rotation>400?-360:360;t.to(this.G,{rotation:o+4*l,duration:a,X:"expo4.inOut",Y:this,q(){this.F.forEach((t=>t.L?.()))}}),t.to(`#${this.id} > svg`,{scale:1.5,opacity:.75,rotation:o-2*l,duration:.5*a,X:"sine.inOut"}),t.to(`#${this.id} > svg`,{scale:.5,opacity:1,rotation:o-l,duration:.25*a,delay:.5*a,X:"sine.inOut"}),t.to(`#${this.id} > svg`,{scale:1,rotation:o-l,duration:.25*a,delay:.75*a,X:"sine.inOut"})}async Et(t){this.ut(t).H();this.gt(5,"sine.inOut"),this.B(!0)}}